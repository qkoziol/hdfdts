# Makefile to build the IO speed measurement tool.

# Change this if you want to use a compiler other than gcc.
CC=gcc

# Uncomment this if you want to use DIRECT-IO.
#DIRECTIO_FLAGS=-DHAVE_DIRECTIO

# Uncomment these if you want to use FFIO.
#FFIO_FLAGS=-DHAVE_FFIO
#FFIO_LIBS=-lffio -lrt

# Uncomment this if you want to use MMAP
#MMAP_FLAGS=-DHAVE_MMAP

# Comment this if Aligned memory support is not desired or if posix_memalign()
# is not supported.
ALIGNED_FLAGS=-DHAVE_ALIGNED

# Uncomment this if the definition of posix_memalign() is not found.
#XOPEN_FLAGS=-D_XOPEN_SOURCE=600

# If errors, such as integer overflow, occur for file size larger than 2GB,
# you may want to uncomment the GCC_FLAGS here.
#GCC_FLAGS=-D_LARGEFILE_SOURCE -D_LARGEFILE64_SOURCE -D_FILE_OFFSET_BITS=64

# need _XOPEN_SOURCE=600 to include the definition of posix_memalign().
CPPFLAGS=$(XOPEN_FLAGS) \
	$(DIRECTIO_FLAGS) $(FFIO_FLAGS) $(MMAP_FLAGS) $(ALIGNED_FLAGS) \
	$(GCC_FLAGS)
CFLAGS=-DNDEBUG $(CPPFLAGS)
LIBS=$(FFIO_LIBS)


iospeed: gopt.c iospeed.c
	$(CC) $(CFLAGS) gopt.c iospeed.c $(LIBS) -o $@

clean:
	rm -f iospeed
